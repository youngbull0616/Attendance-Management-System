webpackJsonp([8],{oELo:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("woOf"),l=a.n(r),i=a("mtWM"),o=a.n(i),s={data:function(){return{tableData:[],ruleForm:{applyNumber:"",applyName:"",beginTime:"",endTime:"",duration:"",reason:"",typeID:"",status:"",approvalID:"",taskTypeID:"1",date1:"",date2:"",date3:"",date4:"",applyTime:this.getTime("datetime"),statusName:"",approvalName:"",approvalTime:"",typeName:""},rules:{typeID:[{required:!0,validator:this.leaveType,trigger:"change"}],date1:[{required:!0,validator:this.beginDate,trigger:"change"}],date2:[{required:!0,validator:this.beginTime,trigger:"change"}],date3:[{required:!0,validator:this.endDate,trigger:"change"}],date4:[{required:!0,validator:this.endTime,trigger:"change"}]},form:{id:"",number:sessionStorage.getItem("username"),name:"",sex:"",birthday:"",departmentID:"",position:"",type:"",entryDate:"",phone:"",address:"",password:"",checkPass:""},employeeNumber:"",employeeName:"",dialogFormVisible:!1,dialogTitle:"",isCreate:!1,isUpdate:!1,isApproval:!1,typeList:[],isPass:!1,isNotApproval:!1}},computed:{duration:function(){var e=this.ruleForm.date1+" "+this.ruleForm.date2,t=new Date(e.replace(/-/g,"/")),a=this.ruleForm.date3+" "+this.ruleForm.date4,r=new Date(a.replace(/-/g,"/")).getTime()-t.getTime();return this.ruleForm.duration=Math.floor(r/36e5),Math.floor(r/36e5)}},created:function(){this.getData(),this.getUsername()},methods:{getData:function(){var e=this;o.a.post("/leave/list",{applyNumber:sessionStorage.getItem("username")}).then(function(t){e.tableData=t.data,e.tableData.forEach(function(e){"0"==e.status?(e.statusName="待审批",e.isNotApproval=!0):"1"==e.status?(e.statusName="已通过",e.isPass=!0):"2"==e.status?e.statusName="已驳回":"3"==e.status&&(e.statusName="已撤销")})})},submitForm:function(){var e=this;this.$refs.ruleForm.validate(function(t){if(!t)return console.log("error submit!!"),!1;e.ruleForm.beginTime=e.ruleForm.date1+" "+e.ruleForm.date2,e.ruleForm.endTime=e.ruleForm.date3+" "+e.ruleForm.date4,o.a.post("/leave/insert",e.ruleForm).then(function(t){e.$message({message:"提交成功",type:"success"}),e.resetTemp(),e.dialogFormVisible=!1,e.getData()})})},getUsername:function(){var e=this;o.a.post("/employee/findByNumber",this.form).then(function(t){e.employeeName=t.data.name,e.employeeNumber=t.data.number,e.ruleForm.applyName=t.data.name,e.ruleForm.applyNumber=t.data.number})},resetTemp:function(){this.ruleForm={applyNumber:this.employeeNumber,applyName:this.employeeName,beginTime:"",endTime:"",duration:"",reason:"",typeID:"",status:"",approvalID:"",taskTypeID:"1",date1:"",date2:"",date3:"",date4:"",applyTime:this.getTime("datetime"),statusName:"",approvalName:"",approvalTime:"",typeName:""}},resetForm:function(){this.ruleForm={applyNumber:"",applyName:"",beginTime:"",endTime:"",duration:"",reason:"",typeID:"",status:"",approvalID:"",taskTypeID:"1",date1:"",date2:"",date3:"",date4:"",applyTime:this.getTime("datetime"),statusName:"",approvalName:"",approvalTime:"",typeName:""},this.ruleForm.applyNumber=this.employeeNumber,this.ruleForm.applyName=this.employeeName,this.ruleForm.applyTime=this.getTime("datetime"),this.taskTypeID="1"},getTime:function(e){var t=new Date,a=t.getFullYear(),r=t.getMonth()+1,l=t.getDate(),i=t.getMinutes(),o=t.getHours(),s=t.getSeconds();if(r>=1&&r<=9&&(r="0"+r),l>=0&&l<=9&&(l="0"+l),o>=0&&o<=9&&(o="0"+o),i>=0&&i<=9&&(i="0"+i),s>=0&&s<=9&&(s="0"+s),"date"==e)var m=a+"-"+r+"-"+l;else if("time"==e)m=o+":"+i+":"+s;else m=a+"-"+r+"-"+l+" "+o+":"+i+":"+s;return m},handleCreate:function(){this.dialogTitle="发送申请",this.isCreate=!0,this.isUpdate=!1,this.isApproval=!1,this.dialogFormVisible=!0,this.getTypeList(),this.resetForm()},handleUpdate:function(e){this.ruleForm=l()({},e),this.ruleForm.applyName=this.employeeName,this.getDuration(),"0"==this.ruleForm.status||"3"==this.ruleForm.status?this.isApproval=!1:"1"!=this.ruleForm.status&&"2"!=this.ruleForm.status||(this.isApproval=!0),this.dialogTitle="请假详情",this.isUpdate=!0,this.isCreate=!1,this.dialogFormVisible=!0},getTypeList:function(){var e=this;o.a.get("/leaveType/list").then(function(t){e.typeList=t.data})},getDuration:function(){var e=new Date(this.ruleForm.beginTime.replace(/-/g,"/")),t=new Date(this.ruleForm.endTime.replace(/-/g,"/")).getTime()-e.getTime();this.ruleForm.duration=Math.floor(t/36e5)},compareDate:function(e,t){return new Date(t).getTime()>=new Date(e).getTime()},beginDate:function(e,t,a){t?this.compareDate(this.getTime("date"),t)?this.ruleForm.date3?this.compareDate(t,this.ruleForm.date3)?a():a(new Error("开始日期不能在结束日期之后，请重新选择")):a():a(new Error("开始日期不能早于当前日期，请重新选择")):a(new Error("开始日期不能为空！"))},endDate:function(e,t,a){t?this.ruleForm.date1?this.compareDate(this.ruleForm.date1,t)?a():a(new Error("结束日期不能早于开始日期，请重新选择")):a():a(new Error("结束日期不能为空！"))},beginTime:function(e,t,a){t?this.ruleForm.date1?new Date(this.ruleForm.date1).getTime()==new Date(this.getTime("date")).getTime()?this.compareDate(this.getTime("datetime"),this.ruleForm.date1+" "+t)?a():a(new Error("开始时间不能早于当前时间，请重新选择")):this.ruleForm.date3&&new Date(this.ruleForm.date1).getTime()==new Date(this.ruleForm.date3).getTime()&&this.ruleForm.date4?this.compareDate(this.ruleForm.date1+" "+t,this.ruleForm.date3+" "+this.ruleForm.date4)?a():a(new Error("开始时间不能晚于结束时间，请重新选择")):a():a():a(new Error("开始时间不能为空！"))},endTime:function(e,t,a){t?new Date(this.ruleForm.date1).getTime()==new Date(this.ruleForm.date3).getTime()&&this.ruleForm.date2?this.compareDate(this.ruleForm.date1+" "+this.ruleForm.date2,this.ruleForm.date3+" "+t)?a():a(new Error("结束时间不能早于开始时间，请重新选择")):a():a(new Error("结束时间不能为空！"))},leaveType:function(e,t,a){t?a():a(new Error("请选择请假类型"))}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"text-align":"left","margin-left":"20px"}},[a("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.handleCreate}},[e._v(" 发起申请")])],1),e._v(" "),a("div",{staticStyle:{display:"flex","flex-direction":"row","flex-wrap":"wrap"}},e._l(e.tableData,function(t){return a("el-card",{key:t.id,staticClass:"box-card",staticStyle:{width:"328px",margin:"20px"},scopedSlots:e._u([{key:"header",fn:function(){return[a("div",{staticClass:"card-header"},[t.isPass?a("span",{staticStyle:{color:"green",float:"left"}},[e._v(e._s(t.statusName))]):t.isNotApproval?a("span",{staticStyle:{color:"gray",float:"left"}},[e._v(e._s(t.statusName))]):a("span",{staticStyle:{color:"red",float:"left"}},[e._v(e._s(t.statusName))]),e._v(" "),a("span",[e._v(e._s(e.ruleForm.applyName)+"提交的请假申请")])])]},proxy:!0}],null,!0)},[e._v(" "),a("div",{staticClass:"text item"},[e._v("\n        "+e._s("请假类型："+t.typeName)+"\n      ")]),e._v(" "),a("div",{staticClass:"text item"},[e._v("\n        "+e._s("申请时间："+t.applyTime)+"\n      ")]),e._v(" "),a("div",{staticClass:"text item",staticStyle:{"text-align":"center"}},[a("el-button",{staticClass:"button",attrs:{type:"text"},on:{click:function(a){return e.handleUpdate(t)}}},[e._v(" 查看详情")])],1)])}),1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",staticStyle:{width:"100%"},attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"申请人",prop:"name"}},[a("el-input",{attrs:{readonly:""},model:{value:e.ruleForm.applyName,callback:function(t){e.$set(e.ruleForm,"applyName",t)},expression:"ruleForm.applyName"}})],1),e._v(" "),e.isUpdate?a("el-form-item",{attrs:{label:"申请时间",prop:"applyTime"}},[a("el-input",{attrs:{readonly:""},model:{value:e.ruleForm.applyTime,callback:function(t){e.$set(e.ruleForm,"applyTime",t)},expression:"ruleForm.applyTime"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"请假类型",prop:"typeID"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择",disabled:e.isUpdate},model:{value:e.ruleForm.typeID,callback:function(t){e.$set(e.ruleForm,"typeID",t)},expression:"ruleForm.typeID"}},e._l(e.typeList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),e.isCreate?a("el-form-item",{attrs:{label:"开始时间",prop:"beginTime"}},[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{prop:"date1"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",readonly:e.isUpdate},model:{value:e.ruleForm.date1,callback:function(t){e.$set(e.ruleForm,"date1",t)},expression:"ruleForm.date1"}})],1)],1),e._v(" "),a("el-col",{staticClass:"line",attrs:{span:2}},[e._v("-")]),e._v(" "),a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{prop:"date2"}},[a("el-time-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"选择时间","value-format":"HH:mm:ss",readonly:e.isUpdate},model:{value:e.ruleForm.date2,callback:function(t){e.$set(e.ruleForm,"date2",t)},expression:"ruleForm.date2"}})],1)],1)],1):e._e(),e._v(" "),e.isUpdate?a("el-form-item",{attrs:{label:"开始时间",prop:"beginTime"}},[a("el-input",{attrs:{readonly:e.isUpdate},model:{value:e.ruleForm.beginTime,callback:function(t){e.$set(e.ruleForm,"beginTime",t)},expression:"ruleForm.beginTime"}})],1):e._e(),e._v(" "),e.isCreate?a("el-form-item",{attrs:{label:"结束时间",prop:"endTime"}},[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{prop:"date3"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",readonly:e.isUpdate},model:{value:e.ruleForm.date3,callback:function(t){e.$set(e.ruleForm,"date3",t)},expression:"ruleForm.date3"}})],1)],1),e._v(" "),a("el-col",{staticClass:"line",attrs:{span:2}},[e._v("-")]),e._v(" "),a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{prop:"date4"}},[a("el-time-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"选择时间","value-format":"HH:mm:ss",readonly:e.isUpdate},model:{value:e.ruleForm.date4,callback:function(t){e.$set(e.ruleForm,"date4",t)},expression:"ruleForm.date4"}})],1)],1)],1):e._e(),e._v(" "),e.isUpdate?a("el-form-item",{attrs:{label:"结束时间",prop:"endTime"}},[a("el-input",{attrs:{readonly:e.isUpdate},model:{value:e.ruleForm.endTime,callback:function(t){e.$set(e.ruleForm,"endTime",t)},expression:"ruleForm.endTime"}})],1):e._e(),e._v(" "),e.isCreate?a("el-form-item",{attrs:{label:"时长",prop:"duration"}},[a("el-input",{attrs:{placeholder:e.duration,readonly:""},model:{value:e.ruleForm.duration,callback:function(t){e.$set(e.ruleForm,"duration",t)},expression:"ruleForm.duration"}})],1):e._e(),e._v(" "),e.isUpdate?a("el-form-item",{attrs:{label:"时长",prop:"duration"}},[a("el-input",{attrs:{readonly:""},model:{value:e.ruleForm.duration,callback:function(t){e.$set(e.ruleForm,"duration",t)},expression:"ruleForm.duration"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"请假事由",prop:"reason"}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入请假事由",readonly:e.isUpdate},model:{value:e.ruleForm.reason,callback:function(t){e.$set(e.ruleForm,"reason",t)},expression:"ruleForm.reason"}})],1),e._v(" "),e.isApproval?a("el-form-item",{attrs:{label:"审批人",prop:"approvalName"}},[a("el-input",{attrs:{readonly:""},model:{value:e.ruleForm.approvalName,callback:function(t){e.$set(e.ruleForm,"approvalName",t)},expression:"ruleForm.approvalName"}})],1):e._e(),e._v(" "),e.isApproval?a("el-form-item",{attrs:{label:"审批时间",prop:"approvalTime"}},[a("el-input",{attrs:{readonly:""},model:{value:e.ruleForm.approvalTime,callback:function(t){e.$set(e.ruleForm,"approvalTime",t)},expression:"ruleForm.approvalTime"}})],1):e._e(),e._v(" "),e.isUpdate?a("el-form-item",{attrs:{label:"审批状态",prop:"course"}},[a("el-input",{attrs:{readonly:e.isUpdate},model:{value:e.ruleForm.statusName,callback:function(t){e.$set(e.ruleForm,"statusName",t)},expression:"ruleForm.statusName"}})],1):e._e(),e._v(" "),a("el-form-item",[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(" 取 消")]),e._v(" "),e.isCreate?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v(" 提 交")]):e._e()],1)],1)],1)],1)},staticRenderFns:[]};var n=a("VU/8")(s,m,!1,function(e){a("xiWH")},null,null);t.default=n.exports},xiWH:function(e,t){}});
//# sourceMappingURL=8.afe754d9c0cbca7d5448.js.map